<template>
  <div class="view-container">
    <Background ref="background" />
    <DateAndHourHeader />

    <Meteo
      v-if="Object.keys(views).includes('weather')"
      :isActive="currentView == 'weather'"
    />
    <Menus
      v-if="Object.keys(views).includes('menus')"
      :isActive="currentView == 'menus'"
    />
    <Planning
      v-if="Object.keys(views).includes('planning')"
      :isActive="currentView == 'planning'"
    />
    <Transport
      v-if="Object.keys(views).includes('transport')"
      :isActive="currentView == 'transport'"
    />

    <LoadingOverlay ref="loading" />
  </div>
</template>

<script>
import DateAndHourHeader from "./components/DateHourHeader.vue";
import LoadingOverlay from "./components/LoadingOverlay.vue";
import Background from "./components/Background.vue";
import Menus from "./views/Menus.vue";
import Transport from "./views/NextTransports.vue";
import Meteo from "./views/Weather.vue";
import Planning from "./views/NextPlannings.vue";

import "./stylesheets/reset.css";

export default {
  name: "App",
  data() {
    return {
      currentView: "transport",
      views: {
        /*
          To active only one or some views, juste comment here what you dont want to be
          displayed.
          If only one view is uncommented, the slide show will be disabled (Usefull for development).

          The order in the object is the display order
        */
        transport: {
          time: 1000 * 10,
          allowed: () => true, // TO DO
        },
        menus: {
          time: 1000 * 10,
          allowed: () => true, // TO DO
        },
        planning: {
          time: 1000 * 10,
          allowed: () => true, // TO DO
        },
        weather: {
          // DISABLE (NEED #36 TO BE FIXED)
          time: 1000 * 10,
          allowed: () => true, // TO DO
        },
      },
    };
  },
  methods: {
    /**
     * @return the name of the next view that will be displayed
     */
    getNextViewName() {
      const viewTypes = Object.keys(this.views);
      let nextView = viewTypes[viewTypes.indexOf(this.currentView) + 1];
      if (nextView === undefined) nextView = viewTypes[0];
      return nextView;
    },
    changeView() {
      // WIP - View manager logic as to be made here

      // TO DO
      // - Better timings
      // - Handling allowed functions

      this.currentView = this.getNextViewName();

      if (Object.keys(this.views).length <= 1)
        //Detect we've commented all views except one
        return; // (Disable slide show)

      setTimeout(() => {
        this.$refs.loading && this.$refs.loading.show();
        this.$refs.background && this.$refs.background.next();
        setTimeout(this.changeView, 200);
      }, this.views[this.currentView].time);
    },
  },
  mounted() {
    this.$refs.background && this.$refs.background.next();
    this.$refs.background && this.$refs.background.next();
    this.changeView();
  },
  components: {
    LoadingOverlay,
    Background,
    Meteo,
    Menus,
    Transport,
    Planning,
    DateAndHourHeader
  },
};
</script>

<style>
#app {
  font-family: "Poppins", sans-serif;
  font-weight: bold;
  font-size: 1.2em;

  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  text-align: center;
}

.view-container {
  position: absolute;
  top: 0;
  bottom: 0;
  right: 0;
  left: 0;

  display: flex;
  justify-content: space-evenly;
  align-items: center;
  flex-direction: column;

  height: 100vh;
  overflow: hidden; /* Hide scroll-bars */
}

.view-content {
  width: 100%;

  display: flex;
  flex-direction: row;
  flex-wrap: wrap;
  justify-content: space-evenly;
}

.view-title {
  background-color: white;
  box-shadow: 0px 1px 15px rgba(0, 0, 0, 0.25);

  color: grey;

  font-size: 30px;
  font-weight: 800;
  padding: 30px 50px;
  border-radius: 30px;
}
</style>
